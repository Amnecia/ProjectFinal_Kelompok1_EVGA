{% include 'header.html' %}
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Website Name</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Sedan+SC&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link href="../static/assets/mystyle.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl7/1L_dstPt3HV5HzF6Gvk/e3s4Wz6iJgD/+ub2oU" crossorigin="anonymous" referrerpolicy="no-referrer" />   
  <script src="https://kit.fontawesome.com/d46734533e.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

  <style>
    body {
      font-family: sans-serif;
      margin: 0;
    }

    .content-container {
      padding-top: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .content {
      width: 80%;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .order-item {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px;
    }

    .details {
      flex-grow: 1;
    }

    .remove {
      background-color: #ddd;
      border: 1px solid #ccc;
      padding: 10px;
      cursor: pointer;
    }

    .content img {
      width: 150px;
      height: 150px;
      background-color: #eee;
      display: block;
      margin-right: 20px;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    .quantity-controls button {
      padding: 2px 8px;
      border: 1px solid #ddd;
      background-color: #f8f8f8;
      cursor: pointer;
      font-size: 14px;
    }

    .quantity-controls span {
      margin: 0 10px;
      font-size: 14px;
    }

    .total-container {
      width: 80%;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .total-container .total-price {
      font-size: 20px;
      font-weight: bold;
    }

    .total-container .checkout-button {
      background-color: #ffa500;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      width: 100%;
      box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
      z-index: 1;
      top: 60px;
      padding-top: 10px;
    }

    .dropdown-content a:hover {
      background-color: #f1f1f1;
    }

    .show {
      display: block;
    }

    .profile-info {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .profile-info img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .profile-info .edit-profile {
      color: black;
      font-weight: bold;
      font-size: 18px;
      margin-right: 10px;
    }

    .logout-box {
      border: 1px solid black;
      padding: 5px 10px;
      display: inline-block;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- Konten utama -->
  <div class="content-container">
    <!-- Konten 1 -->
    <div class="content" data-product-id="1" data-price="15000">
      <div class="order-item">
        <img src="#" alt="Image Placeholder">
        <div class="details">
          <h3>Bakso Aci Tulang Rangu</h3>
          <form id="form1">
            <input type="hidden" name="product_id" value="1">
            <label for="email1">Email:</label>
            <input type="email" id="email1" name="email" value="example@gmail.com">
            <br>
            <label for="address1">Address:</label>
            <input type="text" id="address1" name="address" value="Jl. Contoh12, No. 12">
          </form>
          <div class="quantity-controls">
            <button class="decrease">-</button>
            <span class="quantity">1</span>
            <button class="increase">+</button>
          </div>
          <p>Harga: Rp. 15.000</p>
          <div class="price">Rp. 15.000</div>
        </div>
        <div class="remove">X</div>
      </div>
    </div>
    <!-- Konten 2 -->
    <div class="content" data-product-id="2" data-price="15000">
      <div class="order-item">
        <img src="#" alt="Image Placeholder">
        <div class="details">
          <h3>Bakso Aci Ayam Suwir</h3>
          <form id="form2">
            <input type="hidden" name="product_id" value="2">
            <label for="email2">Email:</label>
            <input type="email" id="email2" name="email" value="example@gmail.com">
            <br>
            <label for="address2">Address:</label>
            <input type="text" id="address2" name="address" value="Jl. Contoh12, No. 12">
          </form>
          <div class="quantity-controls">
            <button class="decrease">-</button>
            <span class="quantity">1</span>
            <button class="increase">+</button>
          </div>
          <p>Harga: Rp. 15.000</p>
          <div class="price">Rp. 15.000</div>
        </div>
        <div class="remove">X</div>
      </div>
    </div>
    <!-- Konten 3 -->
    <div class="content" data-product-id="3" data-price="13000">
      <div class="order-item">
        <img src="#" alt="Image Placeholder">
        <div class="details">
          <h3>Bakso Aci Telur</h3>
          <form id="form3">
            <input type="hidden" name="product_id" value="3">
            <label for="email3">Email:</label>
            <input type="email" id="email3" name="email" value="example@gmail.com">
            <br>
            <label for="address3">Address:</label>
            <input type="text" id="address3" name="address" value="Jl. Contoh12, No. 12">
          </form>
          <div class="quantity-controls">
            <button class="decrease">-</button>
            <span class="quantity">1</span>
            <button class="increase">+</button>
          </div>
          <p>Harga: Rp. 13.000</p>
          <div class="price">Rp. 13.000</div>
        </div>
        <div class="remove">X</div>
      </div>
    </div>
    <!-- Total Harga dan Checkout -->
    <div class="total-container">
      <div class="total-price">Total Harga: Rp. 43.000</div>
      <button class="checkout-button" onclick="checkout()">Checkout</button>
    </div>
  </div>

  <script>
    function updateTotal() {
      let total = 0;
      document.querySelectorAll('.content').forEach(content => {
        const quantity = parseInt(content.querySelector('.quantity').textContent);
        const price = parseInt(content.getAttribute('data-price'));
        total += quantity * price;
      });
      document.querySelector('.total-price').textContent = 'Total Harga: Rp. ' + total.toLocaleString();
    }

    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.increase').forEach(button => {
        button.addEventListener('click', function () {
          const quantityElem = this.previousElementSibling;
          quantityElem.textContent = parseInt(quantityElem.textContent) + 1;
          const priceElem = this.closest('.order-item').querySelector('.price');
          const price = parseInt(this.closest('.content').getAttribute('data-price'));
          priceElem.textContent = 'Rp. ' + (parseInt(quantityElem.textContent) * price).toLocaleString();
          updateTotal();
        });
      });

      document.querySelectorAll('.decrease').forEach(button => {
        button.addEventListener('click', function () {
          const quantityElem = this.nextElementSibling;
          if (parseInt(quantityElem.textContent) > 1) {
            quantityElem.textContent = parseInt(quantityElem.textContent) - 1;
            const priceElem = this.closest('.order-item').querySelector('.price');
            const price = parseInt(this.closest('.content').getAttribute('data-price'));
            priceElem.textContent = 'Rp. ' + (parseInt(quantityElem.textContent) * price).toLocaleString();
            updateTotal();
          }
        });
      });

      document.querySelectorAll('.remove').forEach(button => {
        button.addEventListener('click', function () {
          const product = this.closest('.content');
          product.remove();
          updateTotal();
        });
      });

      updateTotal();
    });

    function checkout() {
      // Mengumpulkan data untuk dikirim ke Flask
      const orders = [];
      document.querySelectorAll('.content').forEach(content => {
        const productId = content.getAttribute('data-product-id');
        const email = content.querySelector('input[name="email"]').value;
        const address = content.querySelector('input[name="address"]').value;
        const quantity = parseInt(content.querySelector('.quantity').textContent);
        const price = parseInt(content.getAttribute('data-price'));
        orders.push({ productId, email, address, quantity, price });
      });

      // Mengirim data menggunakan fetch
      fetch('/order', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ orders }),
      }).then(response => {
        if (response.ok) {
          // Redirect ke halaman status_pesanan jika berhasil
          window.location.href = "/status_pesanan";
        } else {
          alert('Gagal melakukan checkout. Silakan coba lagi.');
        }
      }).catch(error => {
        console.error('Error:', error);
        alert('Terjadi kesalahan saat melakukan checkout. Silakan coba lagi.');
      });
    }
  </script>
</body>
</html>
{% include 'footer.html' %}



